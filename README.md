# Repeat Content Plugin（重复内容复读插件）

## 概览

-   目标：检测群聊中连续出现的相同内容并自动复读，活跃群聊氛围。
-   特点：支持时间窗口、消息数量窗口、相同消息数量等灵活配置，避免过度复读。

## 功能特性

-   智能检测：在指定时间窗口和消息数量窗口内检测连续相同内容。
-   灵活配置：支持自定义时间窗口、消息窗口大小、触发复读的相同消息数量等参数。
-   防刷屏机制：同一内容有复读冷却时间，超过长度限制的消息不处理。
-   群聊专属：仅对群消息生效，支持按群组单独配置（通过 group_overrides）。

## 目录结构（关键文件）

-   `plugin.py`：核心逻辑（事件处理器、复读检测算法、配置管理）。
-   `config.toml`：插件配置（见下方示例）。
-   `_manifest.json`：插件清单。
-   `requirements.txt`：运行依赖。

## 配置示例（`repeat_content_plugin/config.toml`）

```toml
[plugin]
enabled = true

[repeat]
time_window_minutes = 5          # 时间窗口：在x分钟内检测
message_window_size = 10         # 消息数量窗口：在y条消息内检测
required_same_count = 3          # 触发复读的相同消息数量
max_message_length = 100         # 最大消息长度限制，超过则不处理
repeat_cooldown_minutes = 10     # 同一内容复读冷却时间（分钟）

# 群聊覆盖配置（可选）
[group_overrides]
  [group_overrides."902106123"]
  time_window_minutes = 3        # 为特定群组覆盖时间窗口配置
  required_same_count = 2        # 为特定群组覆盖触发复读的相同消息数量
```

## 使用方式

-   自动检测：插件会自动检测群聊中符合条件的相同内容并进行复读。
-   无需手动命令：所有功能都是自动触发的，无需用户发送命令。

## 工作原理

1. **消息收集**：记录每个群组的最近消息，包含时间戳和内容。
2. **窗口过滤**：只保留时间窗口内和消息数量窗口内的消息。
3. **相同内容检测**：统计当前消息在窗口内出现的次数。
4. **复读条件判断**：满足相同消息数量要求且不在冷却时间内。
5. **执行复读**：发送相同内容，并记录复读时间避免重复。

## 注意事项

-   **不影响原有 replay 逻辑**：该插件仅添加了自动复读功能，不会改变原本的 replay 回复逻辑。
-   **保持原有回复**：复读完成后，原本 replay 要回复的内容仍然会正常回复，不会被干扰或覆盖。

## 版本

-   当前插件版本：`1.0.0`
-   变更要点：初始版本，实现基本的重复内容检测和复读功能。
